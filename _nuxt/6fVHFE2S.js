import{o as Ae,E as oe,q as Ve}from"./BH2NPJ5c.js";import{E as Re}from"./D0tAaLOn.js";import{E as De}from"./C41m7MR8.js";import{E as ze}from"./gjyoWeDQ.js";import{E as ye}from"./DhKVA3DV.js";import{a as Ne,b as Pe,E as Ue}from"./Ar1ppV0-.js";import{_ as Fe,G as He,E as Ke,o as ue,T as ce,g as je,l as de,h as qe,V as Ge,W as Xe,X as We,z as Ze,Y as Je,Z as fe,$ as Qe}from"./1AO-i3Qm.js";import"./RgV06_rq.js";import"./VVnNV-vw.js";import{E as Ye}from"./D_9vw2rQ.js";import{E as xe,u as en,a as nn,b as on}from"./CzviV5vG.js";import{D as K,g as Z,X as F,j as h,o as i,w as b,y as J,b as C,a as v,B as d,A as W,v as me,c as M,N,L as H,t as V,a8 as j,C as tn,a3 as Q,d as R,ae as sn,m as L,r as w,H as an,aj as Y,J as pe,E as Ee,a0 as ln,I as rn,S as x,x as te,Q as we,U as ke,P as ve,V as Be,i as un,F as ee,n as Ie,p as g,q as cn,_ as se,M as dn,k as fn,O as ge,G as mn}from"./B91_JGNm.js";import{u as Te}from"./DvWE4exA.js";import{E as pn}from"./BgU5F3RL.js";import{a as Ce}from"./Cl2ZIHhT.js";import{g as vn,E as gn}from"./B4Eicqft.js";import{u as be}from"./Cux0SVlX.js";import"./Bp3YSIOJ.js";import"./BB_Ol6Sd.js";import"./BhUPguzI.js";import"./D6FW0B1r.js";import"./ln9MLy3v.js";const Cn=e=>["",...Ae].includes(e),ne="_trap-focus-children",D=[],he=e=>{if(D.length===0)return;const a=vn(e),t=D[D.length-1][ne];if(t.length>0&&a===gn.tab){if(t.length===1){e.preventDefault(),document.activeElement!==t[0]&&t[0].focus();return}const l=e.shiftKey,s=e.target===t[0],o=e.target===t[t.length-1];s&&l&&(e.preventDefault(),t[t.length-1].focus()),o&&!l&&(e.preventDefault(),t[0].focus())}},bn={beforeMount(e){e[ne]=Ce(e),D.push(e),D.length<=1&&document.addEventListener("keydown",he)},updated(e){K(()=>{e[ne]=Ce(e)})},unmounted(){D.shift(),D.length===0&&document.removeEventListener("keydown",he)}},hn=Z({name:"ElMessageBox",directives:{TrapFocus:bn},components:{ElButton:oe,ElFocusTrap:pn,ElInput:ye,ElOverlay:xe,ElIcon:Ke,...He},inheritAttrs:!1,props:{buttonSize:{type:String,validator:Cn},modal:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},closeOnHashChange:{type:Boolean,default:!0},center:Boolean,draggable:Boolean,overflow:Boolean,roundButton:Boolean,container:{type:String,default:"body"},boxType:{type:String,default:""}},emits:["vanish","action"],setup(e,{emit:a}){const{locale:t,zIndex:l,ns:s,size:o}=Ve("message-box",L(()=>e.buttonSize)),{t:f}=t,{nextZIndex:m}=l,y=w(!1),n=an({autofocus:!0,beforeClose:null,callback:null,cancelButtonText:"",cancelButtonClass:"",confirmButtonText:"",confirmButtonClass:"",customClass:"",customStyle:{},dangerouslyUseHTMLString:!1,distinguishCancelAndClose:!1,icon:"",closeIcon:"",inputPattern:null,inputPlaceholder:"",inputType:"text",inputValue:"",inputValidator:void 0,inputErrorMessage:"",message:"",modalFade:!0,modalClass:"",showCancelButton:!1,showConfirmButton:!0,type:"",title:void 0,showInput:!1,action:"",confirmButtonLoading:!1,cancelButtonLoading:!1,confirmButtonLoadingIcon:Y(ue),cancelButtonLoadingIcon:Y(ue),confirmButtonDisabled:!1,editorErrorMessage:"",validateError:!1,zIndex:m()}),A=L(()=>{const r=n.type;return{[s.bm("icon",r)]:r&&ce[r]}}),p=be(),E=be(),c=L(()=>{const r=n.type;return n.icon||r&&ce[r]||""}),u=L(()=>!!n.message),k=w(),z=w(),B=w(),$=w(),G=w(),I=L(()=>n.confirmButtonClass);pe(()=>n.inputValue,async r=>{await K(),e.boxType==="prompt"&&r&&le()},{immediate:!0}),pe(()=>y.value,r=>{var T,_;r&&(e.boxType!=="prompt"&&(n.autofocus?B.value=(_=(T=G.value)==null?void 0:T.$el)!=null?_:k.value:B.value=k.value),n.zIndex=m()),e.boxType==="prompt"&&(r?K().then(()=>{var re;$.value&&$.value.$el&&(n.autofocus?B.value=(re=Le())!=null?re:k.value:B.value=k.value)}):(n.editorErrorMessage="",n.validateError=!1))});const S=L(()=>e.draggable),_e=L(()=>e.overflow),{isDragging:Me}=en(k,z,S,_e);Ee(async()=>{await K(),e.closeOnHashChange&&window.addEventListener("hashchange",U)}),ln(()=>{e.closeOnHashChange&&window.removeEventListener("hashchange",U)});function U(){y.value&&(y.value=!1,K(()=>{n.action&&a("action",n.action)}))}const ae=()=>{e.closeOnClickModal&&X(n.distinguishCancelAndClose?"close":"cancel")},Se=on(ae),$e=r=>{if(n.inputType!=="textarea")return r.preventDefault(),X("confirm")},X=r=>{var T;e.boxType==="prompt"&&r==="confirm"&&!le()||(n.action=r,n.beforeClose?(T=n.beforeClose)==null||T.call(n,r,n,U):U())},le=()=>{if(e.boxType==="prompt"){const r=n.inputPattern;if(r&&!r.test(n.inputValue||""))return n.editorErrorMessage=n.inputErrorMessage||f("el.messagebox.error"),n.validateError=!0,!1;const T=n.inputValidator;if(x(T)){const _=T(n.inputValue);if(_===!1)return n.editorErrorMessage=n.inputErrorMessage||f("el.messagebox.error"),n.validateError=!0,!1;if(te(_))return n.editorErrorMessage=_,n.validateError=!0,!1}}return n.editorErrorMessage="",n.validateError=!1,!0},Le=()=>{var r,T;const _=(r=$.value)==null?void 0:r.$refs;return(T=_?.input)!=null?T:_?.textarea},ie=()=>{X("close")},Oe=()=>{e.closeOnPressEscape&&ie()};return e.lockScroll&&nn(y,{ns:s}),{...rn(n),ns:s,overlayEvent:Se,visible:y,hasMessage:u,typeClass:A,contentId:p,inputId:E,btnSize:o,iconComponent:c,confirmButtonClasses:I,rootRef:k,focusStartRef:B,headerRef:z,inputRef:$,isDragging:Me,confirmRef:G,doClose:U,handleClose:ie,onCloseRequested:Oe,handleWrapperClick:ae,handleInputEnter:$e,handleAction:X,t:f}}});function yn(e,a,t,l,s,o){const f=F("el-icon"),m=F("el-input"),y=F("el-button"),n=F("el-focus-trap"),A=F("el-overlay");return i(),h(sn,{name:"fade-in-linear",onAfterLeave:p=>e.$emit("vanish"),persisted:""},{default:b(()=>[J(C(A,{"z-index":e.zIndex,"overlay-class":[e.ns.is("message-box"),e.modalClass],mask:e.modal},{default:b(()=>[v("div",{role:"dialog","aria-label":e.title,"aria-modal":"true","aria-describedby":e.showInput?void 0:e.contentId,class:d(`${e.ns.namespace.value}-overlay-message-box`),onClick:e.overlayEvent.onClick,onMousedown:e.overlayEvent.onMousedown,onMouseup:e.overlayEvent.onMouseup},[C(n,{loop:"",trapped:e.visible,"focus-trap-el":e.rootRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:b(()=>[v("div",{ref:"rootRef",class:d([e.ns.b(),e.customClass,e.ns.is("draggable",e.draggable),e.ns.is("dragging",e.isDragging),{[e.ns.m("center")]:e.center}]),style:me(e.customStyle),tabindex:"-1",onClick:W(()=>{},["stop"])},[e.title!==null&&e.title!==void 0?(i(),M("div",{key:0,ref:"headerRef",class:d([e.ns.e("header"),{"show-close":e.showClose}])},[v("div",{class:d(e.ns.e("title"))},[e.iconComponent&&e.center?(i(),h(f,{key:0,class:d([e.ns.e("status"),e.typeClass])},{default:b(()=>[(i(),h(H(e.iconComponent)))]),_:1},8,["class"])):N("v-if",!0),v("span",null,V(e.title),1)],2),e.showClose?(i(),M("button",{key:0,type:"button",class:d(e.ns.e("headerbtn")),"aria-label":e.t("el.messagebox.close"),onClick:p=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel"),onKeydown:j(W(p=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel"),["prevent"]),["enter"])},[C(f,{class:d(e.ns.e("close"))},{default:b(()=>[(i(),h(H(e.closeIcon||"close")))]),_:1},8,["class"])],42,["aria-label","onClick","onKeydown"])):N("v-if",!0)],2)):N("v-if",!0),v("div",{id:e.contentId,class:d(e.ns.e("content"))},[v("div",{class:d(e.ns.e("container"))},[e.iconComponent&&!e.center&&e.hasMessage?(i(),h(f,{key:0,class:d([e.ns.e("status"),e.typeClass])},{default:b(()=>[(i(),h(H(e.iconComponent)))]),_:1},8,["class"])):N("v-if",!0),e.hasMessage?(i(),M("div",{key:1,class:d(e.ns.e("message"))},[tn(e.$slots,"default",{},()=>[e.dangerouslyUseHTMLString?(i(),h(H(e.showInput?"label":"p"),{key:1,for:e.showInput?e.inputId:void 0,innerHTML:e.message},null,8,["for","innerHTML"])):(i(),h(H(e.showInput?"label":"p"),{key:0,for:e.showInput?e.inputId:void 0,textContent:V(e.message)},null,8,["for","textContent"]))])],2)):N("v-if",!0)],2),J(v("div",{class:d(e.ns.e("input"))},[C(m,{id:e.inputId,ref:"inputRef",modelValue:e.inputValue,"onUpdate:modelValue":p=>e.inputValue=p,type:e.inputType,placeholder:e.inputPlaceholder,"aria-invalid":e.validateError,class:d({invalid:e.validateError}),onKeydown:j(e.handleInputEnter,["enter"])},null,8,["id","modelValue","onUpdate:modelValue","type","placeholder","aria-invalid","class","onKeydown"]),v("div",{class:d(e.ns.e("errormsg")),style:me({visibility:e.editorErrorMessage?"visible":"hidden"})},V(e.editorErrorMessage),7)],2),[[Q,e.showInput]])],10,["id"]),v("div",{class:d(e.ns.e("btns"))},[e.showCancelButton?(i(),h(y,{key:0,loading:e.cancelButtonLoading,"loading-icon":e.cancelButtonLoadingIcon,class:d([e.cancelButtonClass]),round:e.roundButton,size:e.btnSize,onClick:p=>e.handleAction("cancel"),onKeydown:j(W(p=>e.handleAction("cancel"),["prevent"]),["enter"])},{default:b(()=>[R(V(e.cancelButtonText||e.t("el.messagebox.cancel")),1)]),_:1},8,["loading","loading-icon","class","round","size","onClick","onKeydown"])):N("v-if",!0),J(C(y,{ref:"confirmRef",type:"primary",loading:e.confirmButtonLoading,"loading-icon":e.confirmButtonLoadingIcon,class:d([e.confirmButtonClasses]),round:e.roundButton,disabled:e.confirmButtonDisabled,size:e.btnSize,onClick:p=>e.handleAction("confirm"),onKeydown:j(W(p=>e.handleAction("confirm"),["prevent"]),["enter"])},{default:b(()=>[R(V(e.confirmButtonText||e.t("el.messagebox.confirm")),1)]),_:1},8,["loading","loading-icon","class","round","disabled","size","onClick","onKeydown"]),[[Q,e.showConfirmButton]])],2)],14,["onClick"])]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])],42,["aria-label","aria-describedby","onClick","onMousedown","onMouseup"])]),_:3},8,["z-index","overlay-class","mask"]),[[Q,e.visible]])]),_:3},8,["onAfterLeave"])}var En=Fe(hn,[["render",yn],["__file","index.vue"]]);const q=new Map,wn=e=>{let a=document.body;return e.appendTo&&(te(e.appendTo)&&(a=document.querySelector(e.appendTo)),de(e.appendTo)&&(a=e.appendTo),de(a)||(a=document.body)),a},kn=(e,a,t=null)=>{const l=C(En,e,x(e.message)||we(e.message)?{default:x(e.message)?e.message:()=>e.message}:null);return l.appContext=t,ke(l,a),wn(e).appendChild(a.firstElementChild),l.component},Bn=()=>document.createElement("div"),In=(e,a)=>{const t=Bn();e.onVanish=()=>{ke(null,t),q.delete(s)},e.onAction=o=>{const f=q.get(s);let m;e.showInput?m={value:s.inputValue,action:o}:m=o,e.callback?e.callback(m,l.proxy):o==="cancel"||o==="close"?e.distinguishCancelAndClose&&o!=="cancel"?f.reject("close"):f.reject("cancel"):f.resolve(m)};const l=kn(e,t,a),s=l.proxy;for(const o in e)ve(e,o)&&!ve(s.$props,o)&&(o==="closeIcon"&&Be(e[o])?s[o]=Y(e[o]):s[o]=e[o]);return s.visible=!0,s};function P(e,a=null){if(!je)return Promise.reject();let t;return te(e)||we(e)?e={message:e}:t=e.callback,new Promise((l,s)=>{const o=In(e,a??P._context);q.set(o,{options:e,callback:t,resolve:l,reject:s})})}const Tn=["alert","confirm","prompt"],_n={alert:{closeOnPressEscape:!1,closeOnClickModal:!1},confirm:{showCancelButton:!0},prompt:{showCancelButton:!0,showInput:!0}};Tn.forEach(e=>{P[e]=Mn(e)});function Mn(e){return(a,t,l,s)=>{let o="";return Be(t)?(l=t,o=""):qe(t)?o="":o=t,P(Object.assign({title:o,message:a,type:"",..._n[e]},l,{boxType:e}),s)}}P.close=()=>{q.forEach((e,a)=>{a.doClose()}),q.clear()};P._context=null;const O=P;O.install=e=>{O._context=e._context,e.config.globalProperties.$msgbox=O,e.config.globalProperties.$messageBox=O,e.config.globalProperties.$alert=O.alert,e.config.globalProperties.$confirm=O.confirm,e.config.globalProperties.$prompt=O.prompt};const Sn=O,$n={class:"listItem-container"},Ln={class:"label"},On=["onClick"],An=Z({__name:"conversationListItem",props:{label:{},data:{}},emits:["update-title","update-delConversation"],setup(e,{emit:a}){const t=Te(),l=w(!1),s=w(null),o=w(""),f=a,m=(c,u)=>{t.handleConversationTop(c,u)},y=c=>{l.value=!0,s.value=c.id,o.value=c.title},n=(c,u)=>{if(!o.value.trim()){Ye({type:"error",title:"修改失败",message:"标题不能为空"});return}f("update-title",o.value,c,u),l.value=!1,s.value=null},A=(c,u)=>{Sn.confirm("删除后将不可恢复!","删除会话",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(()=>{f("update-delConversation",u,c)})},p=un("openOldConversation"),E=(c,u)=>{const k=c.target;k&&(k.closest(".el-button")||p(u))};return(c,u)=>{const k=ye,z=oe,B=Pe,$=Ne,G=Ue;return i(),M("div",$n,[v("p",Ln,V(e.label),1),(i(!0),M(ee,null,Ie(e.data,I=>(i(),M("div",{key:I.id},[g(l)&&g(s)===I.id?(i(),h(k,{key:0,placeholder:"请输入会话名称",class:"edit-input",modelValue:g(o),"onUpdate:modelValue":u[0]||(u[0]=S=>cn(o)?o.value=S:null),onKeyup:j(S=>n(I.id,e.label),["enter"])},null,8,["modelValue","onKeyup"])):(i(),M("div",{key:1,class:"list-item",onClick:S=>E(S,I.id)},[v("p",null,V(I.title),1),C(G,{placement:"bottom-start"},{dropdown:b(()=>[C($,null,{default:b(()=>[I.isTop?(i(),h(B,{key:1,icon:g(We),onClick:S=>m(e.label,I.id)},{default:b(()=>[...u[2]||(u[2]=[R("取消置顶",-1)])]),_:1},8,["icon","onClick"])):(i(),h(B,{key:0,icon:g(Xe),onClick:S=>m(e.label,I.id)},{default:b(()=>[...u[1]||(u[1]=[R("置顶",-1)])]),_:1},8,["icon","onClick"])),C(B,{icon:g(Ze),onClick:S=>A(e.label,I.id)},{default:b(()=>[...u[3]||(u[3]=[R("删除",-1)])]),_:1},8,["icon","onClick"]),C(B,{icon:g(Je),onClick:S=>y(I)},{default:b(()=>[...u[4]||(u[4]=[R("重命名",-1)])]),_:1},8,["icon","onClick"])]),_:2},1024)]),default:b(()=>[C(z,{icon:g(Ge),circle:!0,style:{outline:"none",border:"none"}},null,8,["icon"])]),_:2},1024)],8,On))]))),128))])}}}),Vn=Object.assign(se(An,[["__scopeId","data-v-de38a2db"]]),{__name:"ConversationListItem"}),Rn={class:"header-fold"},Dn={class:"header"},zn={key:2,class:"history-conversation"},Nn=Z({__name:"conversationList",emits:["startNewConversation"],setup(e,{emit:a}){const t=Te();w(0);const l=w(!1);w(null);const s=w(null),o=w(!0),f=a;Ee(()=>{s.value=t.getLabelHistoryList(),o.value=!1});const m=()=>{l.value=!l.value},y=(p,E,c)=>{t.handleEditTitle(p,c,E)},n=(p,E)=>{t.handleDelConversation(p,E)},A=()=>{f("startNewConversation")};return(p,E)=>{const c=oe,u=Re,k=De,z=ze,B=Vn;return i(),M(ee,null,[v("div",Rn,[E[0]||(E[0]=v("h3",null,"情绪回音",-1)),C(c,{icon:g(fe),onClick:m,size:"small"},null,8,["icon"])]),v("div",{class:d(["list-container",{"list-container-fold":g(l)}]),ref:"menuRef"},[v("div",Dn,[E[1]||(E[1]=v("h3",null,"情绪回音",-1)),C(c,{icon:g(fe),onClick:m},null,8,["icon"])]),C(c,{type:"primary",class:"new-conversation-btn",icon:g(Qe),onClick:A},{default:b(()=>[...E[2]||(E[2]=[R("新对话",-1)])]),_:1},8,["icon"]),C(u,{"border-style":"dashed"}),g(o)&&!g(s)?(i(),h(k,{key:0,rows:8,animated:""})):!g(o)&&!g(s)?(i(),h(z,{key:1,description:"暂无历史数据"})):(i(),M("div",zn,[(i(!0),M(ee,null,Ie(g(s),$=>(i(),h(B,{label:$.label,data:$.data,onUpdateTitle:y,onUpdateDelConversation:n},null,8,["label","data"]))),256))]))],2)],64)}}}),Pn=Object.assign(se(Nn,[["__scopeId","data-v-399db42c"]]),{__name:"ConversationList"}),Un={class:"conversation-container"},Fn={class:"main"},Hn=Z({__name:"index",setup(e){const a=dn(),t=L(()=>a.params.id===void 0),l=()=>{t.value||ge("/chat/conversation/new")};return mn("openOldConversation",o=>{ge(`/chat/conversation/${o}`)}),(o,f)=>{const m=Pn,y=fn;return i(),M("div",Un,[C(m,{onStartNewConversation:l}),v("main",Fn,[C(y)])])}}}),fo=se(Hn,[["__scopeId","data-v-bedd39e9"]]);export{fo as default};
